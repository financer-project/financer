import "./globals.css"
import { BlitzProvider } from "./blitz-client"
import { Inter } from "next/font/google"
import { Metadata } from "next"
import { cn } from "@/src/lib/util/utils"
import { Toaster } from "sonner"
import { cookies } from "next/headers"

const inter = Inter({ subsets: ["latin"] })

export const metadata: Metadata = {
    title: {
        default: "Financer",
        template: "%s â€“ Financer"
    },
    description: "Generated by blitz new "
}

const themeScript = `
(function() {
  try {
    var match = document.cookie.match(/(?:^|;\\s*)financer-theme=([^;]*)/);
    var theme = match ? match[1] : 'light';
    var isDark = theme === 'dark' || (theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches);
    if (isDark) {
      document.documentElement.classList.add('dark');
    }
  } catch(e) {}
})()
`

export default async function RootLayout({ children }: Readonly<{ children: React.ReactNode }>) {
    const cookieStore = await cookies()
    const theme = cookieStore.get("financer-theme")?.value ?? "light"
    const initialDark = theme === "dark"

    return (
        <html lang="en" className={initialDark ? "dark" : ""} suppressHydrationWarning>
        <head>
            <script dangerouslySetInnerHTML={{ __html: themeScript }} />
        </head>
        <body className={cn(inter.className)}>
        <BlitzProvider>
            <>{children}</>
            <Toaster />
        </BlitzProvider>
        </body>
        </html>
    )
}
